# Understanding Script Output

Guide to interpreting CSV reports generated by Azure Scripts.

## Output Format

All scripts export data to **CSV (Comma-Separated Values)** format, designed to open in:
- Excel
- Google Sheets
- Power BI
- PowerShell (Import-Csv)
- Any text editor

## Common Columns

Most scripts include these standard columns:

| Column | Description |
|--------|-------------|
| **Scope** | Level of assignment: ManagementGroup, Subscription, ResourceGroup, Resource |
| **ScopeName** | Technical name of the scope |
| **ScopeDisplayName** | User-friendly display name |
| **CreatedOn** | Date assignment was created (ISO 8601 format) |
| **AssignmentId** | Unique identifier for the assignment |

## Filtering & Analysis in PowerShell

### Load and View Data

```powershell
$data = Import-Csv "C:\Reports\output.csv"

# View first 10 rows
$data | Select-Object -First 10

# View column names
$data | Get-Member -MemberType NoteProperty
```

### Filter Examples

```powershell
# Filter by scope
$data | Where-Object { $_.Scope -eq "Subscription" }

# Filter by date (assignments from last 30 days)
$cutoffDate = (Get-Date).AddDays(-30)
$data | Where-Object { [datetime]$_.CreatedOn -gt $cutoffDate }

# Count by category
$data | Group-Object -Property Scope | Select-Object Name, Count
```

### Export Filtered Results

```powershell
# Export subset to new CSV
$data | Where-Object { $_.Scope -eq "Subscription" } | Export-Csv "subscriptions-only.csv" -NoTypeInformation
```

## Script-Specific Output

### analyze-policy.ps1 Output Columns

| Column | Description |
|--------|-------------|
| **Scope** | ManagementGroup or Subscription |
| **ScopeName** | Name of the scope |
| **ScopeDisplayName** | User-friendly scope display name |
| **AssignmentName** | Technical policy assignment name |
| **AssignmentDisplayName** | User-friendly assignment name |
| **EnforcementMode** | "Enforced" or "Audit" |
| **Inherited** | "Direct" or "Inherited" |
| **HasManagedIdentity** | "Yes" or "No" |
| **ManagedIdentityId** | Resource ID if identity present |
| **IdentityType** | "System Assigned" or "User Assigned" |

**Summary Section:** After data rows, includes statistics:
- Count by scope level
- Inheritance breakdown
- Managed identity usage

### analyze-rbac.ps1 Output Columns

| Column | Description |
|--------|-------------|
| **RootManagementGroup** | Top-level management group |
| **ManagementGroup** | Current management group (if applicable) |
| **SubscriptionId** | Subscription ID (if applicable) |
| **ResourceGroupName** | Resource group name (if applicable) |
| **ScopeLevel** | ManagementGroup, Subscription, ResourceGroup, or Resource |
| **AssignmentType** | "Permanent" or "PIM Eligible" |
| **IdentityName** | User, group, or service principal name |
| **IdentityType** | User, Group, ServicePrincipal, or ManagedIdentity |
| **IdentityObjectId** | Azure AD object ID |
| **RoleDefinition** | Name of the role (e.g., "Owner", "Contributor") |
| **RoleDefinitionId** | Role definition unique identifier |
| **Scope** | "Direct" or "Inherited" |
| **State** | Active, Expired, or NotYetActive (PIM only) |
| **StartDateTime** | Assignment start date (PIM only) |
| **EndDateTime** | Assignment end date (PIM only) |
| **Status** | Current status of assignment |
| **PrincipalEmail** | Email address if available |
| **CreatedOn** | Creation date of assignment |

**Summary Section:** After data rows, includes statistics:
- Breakdown by root management group
- Count by scope level
- Breakdown by assignment type (Permanent vs. PIM)
- Assignment state distribution
- Identity type distribution
- Top 10 subscriptions and resource groups

## Opening in Excel

1. Open Excel
2. **File** → **Open**
3. Select the CSV file
4. Data appears with each column as a separate cell
5. Use **Data** → **AutoFilter** to filter by column values

## Opening in Power BI

1. Start Power BI Desktop
2. **Home** → **Get Data** → **Text/CSV**
3. Select the CSV file
4. Review data preview and click **Load**
5. Create visualizations and reports

## Tips for Analysis

### Large Reports (10,000+ rows)

- Use PowerShell for filtering (faster than Excel)
- Import to Power BI for advanced analytics
- Sort by key columns to spot patterns

### Finding Anomalies

```powershell
# Find assignments created today
$today = Get-Date -Format "yyyy-MM-dd"
$data | Where-Object { $_.CreatedOn -like "$today*" }

# Find inherited assignments (usually unexpected)
$data | Where-Object { $_.Scope -eq "Inherited" } | Select-Object -First 20
```

### Creating Summaries

```powershell
# Count assignments by role
$data | Group-Object -Property RoleDefinition | Sort-Object Count -Descending

# Count assignments by identity type
$data | Group-Object -Property IdentityType | Select-Object Name, Count
```

---

**For script-specific questions:** Check the script's [USAGE.md] or [EXAMPLES.md] file.
